
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>ZoOL => Blog</title>
  <meta name="author" content="ZoOL">

  
  <meta name="description" content="rails 新建项目时可以使用-m 参数来使用模板生成新项目 安装需求 *nix系统 git sqlite3/mysql等环境已经安装完毕 rails 3.0.4(之前版本不能使用https的模板地址) 样例 1 rails new my_app -T -J -m https://gist. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://zool.me/blog/page/2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="ZoOL => Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20255130-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">ZoOL => Blog</a></h1>
  
    <h2>I'm ZoOL!</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:zool.me" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2011/02/09/rails3-new-project-template">Rails3新建项目模板</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-09T00:00:00+08:00" pubdate data-updated="true">Feb 9<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>rails 新建项目时可以使用-m 参数来使用模板生成新项目</p>

<h1>安装需求</h1>

<p>*nix系统</p>

<p>git</p>

<p>sqlite3/mysql等环境已经安装完毕</p>

<p>rails 3.0.4(之前版本不能使用https的模板地址)</p>

<h1>样例</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="n">rails</span> <span class="kp">new</span> <span class="n">my_app</span> <span class="o">-</span><span class="n">T</span> <span class="o">-</span><span class="n">J</span> <span class="o">-</span><span class="n">m</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">gist</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mi">777670</span><span class="o">.</span><span class="n">txt</span>
</span></code></pre></td></tr></table></div></figure>


<p>就会自动生成新项目，安装一些gem,如
devise
haml
jquery
rspec
等等
同时自动迁移，删除index.html等等不必要文件。</p>

<p>https://gist.github.com/777670 是我自己配置文件，里面的配置可能不适合每个人， 可以自行fork修改。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2011/02/02/rails-in-the-method-of-handling-large-quantities-of-data">Rails中处理大批量数据的方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-02T00:00:00+08:00" pubdate data-updated="true">Feb 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在实际运用中，我们要对每个用户发一封信的话。 一般的写法是</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">user</span><span class="o">|</span>
</span><span class='line'>  <span class="no">NewsLetter</span><span class="o">.</span><span class="n">weekly_deliver</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>当数据条目超过1000时， 这样的命令会占用大量的内存。</p>

<p>rails里使用find_each方法来处理这样的情况</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">user</span><span class="o">|</span>
</span><span class='line'>  <span class="no">NewsLetter</span><span class="o">.</span><span class="n">weekly_deliver</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>默认是1000条一批
可以用下面的参数指定一批的条数， 还可以指定开始的主键ID</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">User</span><span class="o">.</span><span class="n">find_each</span><span class="p">(</span><span class="ss">:batch_size</span> <span class="o">=&gt;</span> <span class="mi">5000</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">=&gt;</span> <span class="mi">2000</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">user</span><span class="o">|</span>
</span><span class='line'>  <span class="no">NewsLetter</span><span class="o">.</span><span class="n">weekly_deliver</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>find_each 是逐条处理对象， 有另外一个find_in_batches是按数组来处理</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Person</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s2">&quot;age &gt; 21&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">find_in_batches</span> <span class="k">do</span> <span class="o">|</span><span class="n">group</span><span class="o">|</span>
</span><span class='line'>    <span class="nb">sleep</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="c1"># Make sure it doesn&#39;t get too crowded in there!</span>
</span><span class='line'>    <span class="n">group</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">person</span><span class="o">|</span> <span class="n">person</span><span class="o">.</span><span class="n">party_all_night!</span> <span class="p">}</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>看源码， find_each是对find_in_batches的包装</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># File activerecord/lib/active_record/relation/batches.rb, line 19</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">find_each</span><span class="p">(</span><span class="n">options</span> <span class="o">=</span> <span class="p">{})</span>
</span><span class='line'>      <span class="n">find_in_batches</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">records</span><span class="o">|</span>
</span><span class='line'>        <span class="n">records</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">record</span><span class="o">|</span> <span class="k">yield</span> <span class="n">record</span> <span class="p">}</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="nb">self</span>
</span><span class='line'>    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2011/02/02/Set-p3p-header-rails">Rails中设置p3p头</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-02-02T00:00:00+08:00" pubdate data-updated="true">Feb 2<span>nd</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>由于ie6,7的bug，无法跨iframe保存cookies，所以需要设置p3p头</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">before_filter</span>  <span class="ss">:set_p3p</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">set_p3p</span>
</span><span class='line'>    <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">&quot;P3P&quot;</span><span class="o">]=</span><span class="s1">&#39;CP=&quot;CAO PSA OUR&quot;&#39;</span>
</span><span class='line'>  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2011/01/30/Tasks-plug-in-whenever-the-timing-rails">Rails的定时任务插件whenever</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-30T00:00:00+08:00" pubdate data-updated="true">Jan 30<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在做web应用时，有时会需要定时做一些操作，如发邮件，统计信息等。
这些都是需要放在后台来执行, whenever就是这样的一个插件，使用ruby强大的DSL， 高效的配置生成定时任务。
注意，whenever使用的是crontab定时器，所以这个gem在windows上无效。</p>

<p><a href="https://github.com/javan/whenever">github地址</a></p>

<h1>安装</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem <span class="s1">&#39;whenever&#39;</span>, :require <span class="o">=</span>&gt; <span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure>


<h1>开始配置</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> /path/to/myapp/
</span><span class='line'>wheneverize .
</span><span class='line'><span class="c">#会在config目录下生成一个schedule.rb文件</span>
</span></code></pre></td></tr></table></div></figure>


<h1>配置文件说明</h1>

<p>每个配置都是在一个叫every的block里面配置
运行频率 .minutes, .hours, .days, .months
可以运行任务 runner rake command 三种</p>

<h1>例子</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#每隔10分钟运行一次</span>
</span><span class='line'>every 10.minutes <span class="k">do</span>
</span><span class='line'>  <span class="c">#等同于 rails runner MyModel.some_process</span>
</span><span class='line'>  runner <span class="s2">&quot;MyModel.some_process&quot;</span>
</span><span class='line'>  <span class="c">#等同于 rake my:rake:task</span>
</span><span class='line'>  rake <span class="s2">&quot;my:rake:task&quot;</span>
</span><span class='line'>  <span class="c">#等同于在终端执行 /usr/bin/my_great_command</span>
</span><span class='line'>  <span class="nb">command</span> <span class="s2">&quot;/usr/bin/my_great_command&quot;</span>
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>whenever默认使用production环境，可以在配置文件里另外定义</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  <span class="nb">set</span> :environment, :autotest
</span><span class='line'>  <span class="c">#或单独指定</span>
</span><span class='line'>  runner <span class="s2">&quot;MyModel.some_process&quot;</span>, :environment <span class="o">=</span>&gt; :autotest
</span></code></pre></td></tr></table></div></figure>


<h1>高级配置</h1>

<h1>使用at参数来指定分钟</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#每隔两个小时23分钟</span>
</span><span class='line'>every 2.hours, :at <span class="o">=</span>&gt; 23 <span class="k">do</span>
</span><span class='line'><span class="c">#每隔两天在上午4:30</span>
</span><span class='line'>every 2.days, :at <span class="o">=</span>&gt; <span class="s1">&#39;4:30am&#39;</span> <span class="k">do</span>
</span><span class='line'><span class="c">#每周五晚从05:00到23:45每隔15分钟</span>
</span><span class='line'>every :friday, :at <span class="o">=</span>&gt; <span class="o">(</span><span class="s1">&#39;05&#39;</span>..<span class="s1">&#39;23&#39;</span><span class="o">)</span>.to_a.collect <span class="o">{</span>|x| <span class="o">[</span><span class="s2">&quot;#{x}:00&quot;</span>,<span class="s2">&quot;#{x}:15&quot;</span>,<span class="s2">&quot;#{x}:30&quot;</span>,<span class="s2">&quot;#{x}:45&quot;</span><span class="o">]}</span>.flatten <span class="k">do</span>
</span></code></pre></td></tr></table></div></figure>


<h1>与Capistrano结合</h1>

<p>编辑Capistrano的配置文件config/deploy.rb, 加入</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>require <span class="s2">&quot;whenever/capistrano&quot;</span>
</span><span class='line'>...
</span><span class='line'>after <span class="s2">&quot;deploy:symlink&quot;</span>, <span class="s2">&quot;deploy:update_crontab&quot;</span>
</span><span class='line'>  namespace :deploy <span class="k">do</span>
</span><span class='line'><span class="k">    </span>desc <span class="s2">&quot;Update the crontab file&quot;</span>
</span><span class='line'>    task :update_crontab, :roles <span class="o">=</span>&gt; :db <span class="k">do</span>
</span><span class='line'><span class="k">      </span>run <span class="s2">&quot;cd #{release_path} &amp;&amp; whenever --update-crontab #{application}&quot;</span>
</span><span class='line'>    end
</span><span class='line'>  end
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2011/01/29/rails-in-the-method-of-operation-of-time">Rails中对时间的操作方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-29T00:00:00+08:00" pubdate data-updated="true">Jan 29<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>做web应用，和时间打交道是不可免的。rails对ruby的时间模块做了扩展。
本文作于2011年1月29日, ruby版本为1.8.7, rails版本为3.0.3</p>

<h1>基本的时间转换</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">=</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="c1">#utc秒数互相转换</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_i</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">1296308827</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">at</span><span class="p">(</span><span class="mi">1296308827</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="c1">#当前时间的一些变量</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">sec</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">7</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">min</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">47</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">hour</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">21</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">month</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">1</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">year</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">2011</span>
</span><span class='line'><span class="c1">#现在是星期几(注意!!!周日是返回 0 )</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">wday</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">6</span>
</span><span class='line'><span class="c1">#现在是本月第几天</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">day</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">29</span>
</span><span class='line'><span class="c1">#现在是今年第几天</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">yday</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">29</span>
</span><span class='line'><span class="c1">#时间参数的数组</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_a</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="o">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2011</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="kp">false</span><span class="p">,</span> <span class="s2">&quot;CST&quot;</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h1>时间化输出</h1>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-%d %H:%M:%S&quot;</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;2011-01-29 21:47:07&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>参数解释如下</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>  %a - 星期几的英文简写 <span class="o">(</span><span class="sb">``</span>Sun<span class="s1">&#39;&#39;</span><span class="o">)</span>
</span><span class='line'>  %A - 星期几的英文全称 <span class="o">(</span><span class="sb">``</span>Sunday<span class="s1">&#39;&#39;</span><span class="o">)</span>
</span><span class='line'>  %b - 月份的英文简写 <span class="o">(</span><span class="sb">``</span>Jan<span class="s1">&#39;&#39;</span><span class="o">)</span>
</span><span class='line'>  %B - 月份的英文全称 <span class="o">(</span><span class="sb">``</span>January<span class="s1">&#39;&#39;</span><span class="o">)</span>
</span><span class='line'>  %c - 默认的首选本地时间输出格式
</span><span class='line'>  %d - 本月第几天 <span class="o">(</span>01..31<span class="o">)</span>
</span><span class='line'>  %H - 24小时制的小时 <span class="o">(</span>00..23<span class="o">)</span>
</span><span class='line'>  %I - 12小时制的小时 <span class="o">(</span>01..12<span class="o">)</span>
</span><span class='line'>  %j - 今年的第几天 <span class="o">(</span>001..366<span class="o">)</span>
</span><span class='line'>  %m - 月份 <span class="o">(</span>01..12<span class="o">)</span>
</span><span class='line'>  %M - 分钟 <span class="o">(</span>00..59<span class="o">)</span>
</span><span class='line'>  %p - 上午还是下午 <span class="o">(</span><span class="sb">``</span>AM<span class="s1">&#39;&#39;</span>  or  <span class="sb">``</span>PM<span class="s1">&#39;&#39;</span><span class="o">)</span>
</span><span class='line'>  %S - 秒数 <span class="o">(</span>00..60<span class="o">)</span>
</span><span class='line'>  %U - 从星期天算一周开始的本年第几周 <span class="o">(</span>00..53<span class="o">)</span>
</span><span class='line'>  %W - 从星期一算一周开始的本年第几周 <span class="o">(</span>00..53<span class="o">)</span>
</span><span class='line'>  %w - 现在是星期几 <span class="o">(</span>周日是0 , 0..6<span class="o">)</span>
</span><span class='line'>  %x - 默认的日期输出格式 <span class="o">(</span><span class="s2">&quot;01/29/11&quot;</span><span class="o">)</span>
</span><span class='line'>  %X - 默认的时间输出格式 <span class="o">(</span><span class="s2">&quot;21:47:07&quot;</span><span class="o">)</span>
</span><span class='line'>  %y - 年份的后两位 <span class="o">(</span>00..99<span class="o">)</span>
</span><span class='line'>  %Y - 年份
</span><span class='line'>  %Z - 时区名
</span><span class='line'>  %% - 输出%字符
</span></code></pre></td></tr></table></div></figure>


<p>以上是ruby的基本方法，rails对其做了更多的扩展</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#重写了to_s方法，能够接受参数</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Sat Jan 29 21:47:07 +0800 2011&quot;</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:db</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;2011-01-29 21:47:07&quot;</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:number</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;20110129214707&quot;</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:time</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;21:47&quot;</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:short</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;29 Jan 21:47&quot;</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:long</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;January 29, 2011 21:47&quot;</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:long_ordinal</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;January 29th, 2011 21:47&quot;</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_s</span><span class="p">(</span><span class="ss">:rfc822</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="s2">&quot;Sat, 29 Jan 2011 21:47:07 +0800&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>如果要自己设计时间输出格式，按下面方法来，新建一个配置文件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>  <span class="c1"># config/initializers/time_formats.rb</span>
</span><span class='line'>  <span class="no">Time</span><span class="o">::</span><span class="no">DATE_FORMATS</span><span class="o">[</span><span class="ss">:month_and_year</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;%B %Y&quot;</span>
</span><span class='line'>  <span class="no">Time</span><span class="o">::</span><span class="no">DATE_FORMATS</span><span class="o">[</span><span class="ss">:short_ordinal</span><span class="o">]</span> <span class="o">=</span> <span class="nb">lambda</span> <span class="p">{</span> <span class="o">|</span><span class="n">time</span><span class="o">|</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B </span><span class="si">#{</span><span class="n">time</span><span class="o">.</span><span class="n">day</span><span class="o">.</span><span class="n">ordinalize</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>rails对日期的一些扩展</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#指定时间</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">change</span><span class="p">(</span><span class="ss">:year</span><span class="o">=&gt;</span><span class="mi">2012</span><span class="p">,</span> <span class="ss">:month</span><span class="o">=&gt;</span><span class="mi">12</span><span class="p">,</span> <span class="ss">:day</span> <span class="o">=&gt;</span> <span class="mi">21</span><span class="p">,</span> <span class="ss">:hour</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:min</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:sec</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:usec</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Fri</span> <span class="no">Dec</span> <span class="mi">21</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2012</span>
</span><span class='line'>
</span><span class='line'><span class="c1">#begginning家族</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">beginning_of_day</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">midnight</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">beginning_of_week</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Mon</span> <span class="no">Jan</span> <span class="mi">24</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">beginning_of_month</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mo">01</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">beginning_of_quarter</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mo">01</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">beginning_of_year</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mo">01</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="c1">#end家族</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">end_of_day</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">end_of_week</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sun</span> <span class="no">Jan</span> <span class="mi">30</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">end_of_month</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Mon</span> <span class="no">Jan</span> <span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">end_of_quarter</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Thu</span> <span class="no">Mar</span> <span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">end_of_year</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Dec</span> <span class="mi">31</span> <span class="mi">23</span><span class="p">:</span><span class="mi">59</span><span class="p">:</span><span class="mi">59</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="c1">#时间的魔术方法</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">yesterday</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Fri</span> <span class="no">Jan</span> <span class="mi">28</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">tomorrow</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sun</span> <span class="no">Jan</span> <span class="mi">30</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">next_week</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Mon</span> <span class="no">Jan</span> <span class="mi">31</span> <span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">next_month</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Mon</span> <span class="no">Feb</span> <span class="mi">28</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">next_year</span>
</span><span class='line'><span class="c1">#注意没有prev_week</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">prev_month</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Wed</span> <span class="no">Dec</span> <span class="mi">29</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2010</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">prev_year</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Fri</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2010</span>
</span><span class='line'><span class="c1">#今日已过秒数</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">seconds_since_midnight</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mi">78427</span><span class="o">.</span><span class="mi">615017</span>
</span><span class='line'><span class="c1">#日期输出</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_date</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span><span class="p">,</span> <span class="mi">29</span> <span class="no">Jan</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">to_datetime</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span><span class="p">,</span> <span class="mi">29</span> <span class="no">Jan</span> <span class="mi">2011</span> <span class="mi">21</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span>
</span><span class='line'><span class="c1">#按秒数计算</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">ago</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mi">20</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span><span class='line'><span class="o">&gt;&gt;</span> <span class="n">now</span><span class="o">.</span><span class="n">since</span><span class="p">(</span><span class="mi">3600</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="no">Sat</span> <span class="no">Jan</span> <span class="mi">29</span> <span class="mi">22</span><span class="p">:</span><span class="mi">47</span><span class="p">:</span><span class="mo">07</span> <span class="mi">0800</span> <span class="mi">2011</span>
</span></code></pre></td></tr></table></div></figure>


<p>实际上还有很多方法没有列出，具体使用还是参考rails的api手册为准。</p>

<p>另外有一个rails插件bystar对此做了更多的扩展, 后面会另外写一篇文章来说明</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/ruby/2011/01/25/ruby-string-remove-space-methods">Ruby中去除字符串空格的方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-25T00:00:00+08:00" pubdate data-updated="true">Jan 25<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>使用 String#strip方法,去除所有空格</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="s2">&quot;    hello    &quot;</span><span class="o">.</span><span class="n">strip</span>   <span class="c1">#=&gt; &quot;hello&quot;</span>
</span><span class='line'><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">goodbye</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">strip</span>   <span class="c1">#=&gt; &quot;goodbye&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>另外lstrip和rstrip分别去除字符串左右两端的空格</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="s2">&quot;  hello  &quot;</span><span class="o">.</span><span class="n">lstrip</span>   <span class="c1">#=&gt; &quot;hello  &quot;</span>
</span><span class='line'><span class="s2">&quot;hello&quot;</span><span class="o">.</span><span class="n">lstrip</span>       <span class="c1">#=&gt; &quot;hello&quot;</span>
</span><span class='line'><span class="s2">&quot;  hello  &quot;</span><span class="o">.</span><span class="n">rstrip</span>   <span class="c1">#=&gt; &quot;  hello&quot;</span>
</span><span class='line'><span class="s2">&quot;hello&quot;</span><span class="o">.</span><span class="n">rstrip</span>       <span class="c1">#=&gt; &quot;hello&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>上述方法是返回字符串的copy,如要改变原字符串对象，使用 String#strip!, String#lstrip!, String#rstrip!。 如果对象没有改变则返回nil</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="s2">&quot;hello&quot;</span><span class="o">.</span><span class="n">rstrip!</span>      <span class="c1">#=&gt; nil</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2011/01/25/rails-in-some-of-the-ways-to-obtain-information-url">Rails中获取url信息的一些方法</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-01-25T00:00:00+08:00" pubdate data-updated="true">Jan 25<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>如本机我测试域名为test.blog.zool.it:3000</p>

<p>打开的uri为 /post/Hello-World</p>

<p>fullurl为 http://test.blog.zool.it:3000/post/Hello-world</p>

<p>则rails的路由生成一下几个方法</p>

<h1>domain(tld_length = 1)</h1>

<p>取得域名</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">domain</span> <span class="c1">#=&gt;  zool.it</span>
</span><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">domain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#=&gt; blog.zool.it</span>
</span></code></pre></td></tr></table></div></figure>


<h1>subdomain(tld_length = 1)</h1>

<h1>subdomains(tld_length = 1)</h1>

<p>取得子域名</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">subdomain</span> <span class="c1">#=&gt;  &quot;test.blog&quot;</span>
</span><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">subdomain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#=&gt; &quot;test&quot;</span>
</span><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">subdomain</span> <span class="c1">#=&gt;  [&quot;test&quot;, &quot;blog&quot;]</span>
</span><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">subdomain</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1">#=&gt; [&quot;test&quot;]</span>
</span></code></pre></td></tr></table></div></figure>


<h1>host()</h1>

<p>取得主机名</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">host</span> <span class="c1">#=&gt; &quot;test.blog.zool.it&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>host_with_port()</h1>

<p>取得带端口的主机名</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">host_with_port</span> <span class="c1">#=&gt; &quot;test.blog.zool.it:3000&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>raw_host_with_port()</h1>

<p>代理服务器的主机名和端口</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">raw_host_with_port</span> <span class="c1">#=&gt; &quot;test.blog.zool.it:3000&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>port()</h1>

<p>取得由raw_host_with_port()获得的端口数值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">port</span> <span class="c1">#=&gt; 3000</span>
</span></code></pre></td></tr></table></div></figure>


<h1>port_string()</h1>

<p>取得raw_host_with_port()获得的端口文本字符串</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">port_string</span> <span class="c1">#=&gt; &quot;:3000&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>protocol()</h1>

<p>取得当前使用网络协议</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">protocol</span> <span class="c1">#=&gt; &quot;http://&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>scheme()</h1>

<p>取得网络协议</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">scheme</span> <span class="c1">#=&gt; &quot;http&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>request_uri()</h1>

<p>request请求的uri地址</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">request_uri</span> <span class="c1">#=&gt; &quot;/posts/Hello-World&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>server_port</p>

<h1>server_port()</h1>

<p>取得由env[&#8216;SERVER_PORT&#8217;]返回的端口值</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">server_port</span> <span class="c1">#=&gt; &quot;3000&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>ssl?()</h1>

<p>当前是否在是用https加密协议</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">ssl?</span><span class="p">()</span> <span class="c1">#=&gt; false</span>
</span></code></pre></td></tr></table></div></figure>


<h1>standard_port()</h1>

<p>返回网络协议标准端口(http为80, https为443)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">standard_port</span> <span class="c1">#=&gt; 80</span>
</span></code></pre></td></tr></table></div></figure>


<h1>standard_port?()</h1>

<p>判断当前协议是否是标准端口</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">standard_port?</span> <span class="c1">#=&gt; false</span>
</span></code></pre></td></tr></table></div></figure>


<h1>url()</h1>

<p>取得当前requset完整url</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">request</span><span class="o">.</span><span class="n">url</span> <span class="c1">#=&gt; &quot;http://test.blog.zool.it:3000/posts/Hello-World&quot;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2010/12/30/rails3-plug-ins-to-provide-soft-delete">Rails3中提供软删除的插件</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-30T00:00:00+08:00" pubdate data-updated="true">Dec 30<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/teambox/immortal">github地址</a></p>

<p>有时候，我们希望一条记录删除后仍旧保留在数据库里，这样我们可以在日后还有反悔查询的机会。</p>

<p>P.S. 在rails2时代， 这个功能由 acts_as_paranoid  这个插件实现.</p>

<p>代码胜千言</p>

<h1>安装</h1>

<p>在Gemfile里加入插件配置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gem <span class="s1">&#39;immortal&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>在你要做软删除的model里引用插件</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>class User &lt; ActiveRecord::Base
</span><span class='line'>  include Immortal
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>在users表的字段上加上deleted这个字段</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rails g migration AddDeletedToUser deleted:boolean
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>class AddDeletedToUser &lt; ActiveRecord::Migration
</span><span class='line'>  def self.up
</span><span class='line'>    add_column :users, :deleted, :boolean
</span><span class='line'>  end
</span><span class='line'>
</span><span class='line'>  def self.down
</span><span class='line'>    remove_column :users, :deleted
</span><span class='line'>  end
</span><span class='line'>end
</span></code></pre></td></tr></table></div></figure>


<p>在控制台里测试</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&gt;user <span class="o">=</span> User.create<span class="o">(</span>:username <span class="o">=</span>&gt; <span class="s1">&#39;zool&#39;</span><span class="o">)</span>
</span><span class='line'> <span class="o">=</span>&gt; <span class="c">#&lt;User id: 1, username: &quot;zool&quot;, created_at: &quot;2010-12-30 12:09:42&quot;, updated_at: &quot;2010-12-30 12:09:42&quot;, deleted: nil&gt;</span>
</span><span class='line'>&gt;user.destroy
</span><span class='line'>&gt;User.all <span class="o">=</span>&gt; <span class="c"># []</span>
</span><span class='line'>&gt;User.find_by_sql<span class="o">(</span><span class="s2">&quot;select * from users;&quot;</span><span class="o">)</span>
</span><span class='line'> <span class="o">=</span>&gt; <span class="o">[</span><span class="c">#&lt;User id: 1, username: &quot;zool&quot;, created_at: &quot;2010-12-30 12:09:42&quot;, updated_at: &quot;2010-12-30 12:09:42&quot;, deleted: true&gt;] </span>
</span><span class='line'>&gt;User.where<span class="o">(</span><span class="s2">&quot;id = 1&quot;</span><span class="o">)</span>.to_sql
</span><span class='line'> <span class="o">=</span>&gt; <span class="s2">&quot;SELECT \&quot;users\&quot;.* FROM \&quot;users\&quot; WHERE ((\&quot;users\&quot;.\&quot;deleted\&quot; IS NULL OR \&quot;users\&quot;.\&quot;deleted\&quot; = &#39;f&#39;)) AND (id = 1)&quot;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/rails/2010/12/30/Chinese-rails-configuration">Rails中文配置</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-30T00:00:00+08:00" pubdate data-updated="true">Dec 30<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>rails默认为英文，像一些model的验证提示都是英文。
按下面方法将其汉化</p>

<p>首先，在<a href="https://github.com/svenfuchs/rails-i18n/tree/master/rails/locale">https://github.com/svenfuchs/rails-i18n/tree/master/rails/locale</a>下载相应的语言包</p>

<p>中文选择 zh-CN.yml   ,将其下载到config/locale下面</p>

<p>然后在config/application.rb里加入下面的配置</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>config.i18n.default_locale <span class="o">=</span> :<span class="s1">&#39;zh-CN&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>这句话的意思是将rails的语言包默认为简体中文</p>

<p>然后重启服务器即可</p>

<p>效果</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ruby-1.8.7-p302 &gt; I18n.l Time.now
</span><span class='line'> <span class="o">=</span>&gt; <span class="s2">&quot;2010年12月30日 星期四 10:11:21 CST&quot;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/ruby/2010/12/29/ruby-Happy-New-Year">Ruby-新年快乐</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-29T00:00:00+08:00" pubdate data-updated="true">Dec 29<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>根据网上的源码改编</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'> ruby -e <span class="s2">&quot;((1..20).to_a+[6]*4).each{|i|puts (&#39;#&#39;*i*2).center(80)};puts;puts &#39;Happy New Year&#39;.center(80)&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>关键是center方法</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s2">&quot;Happy New Year&quot;</span>.center<span class="o">(</span>80<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>就是将字符串在80个字符的长度内居中</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/3/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/rails/2011/06/27/setup-rails-generator-orm">设置rails中generator使用的orm类型</a>
      </li>
    
      <li class="post">
        <a href="/rails/2011/06/23/carriewave-support-for-rails-admin">增加carrierwave对rails_admin的支持</a>
      </li>
    
      <li class="post">
        <a href="/rails/2011/05/26/rails31rc1-execjs-error">rails3.1rc1在服务器上运行报Could not find a JavaScript runtime错误的解决方法</a>
      </li>
    
      <li class="post">
        <a href="/rails/2011/05/26/rails-footnotes">rails调试插件rails-footnotes使用说明</a>
      </li>
    
      <li class="post">
        <a href="/rails/2011/05/23/rails3rc1-rspec-invaild-gemspec">rails3rc1在安装rspec-rails时碰到报错</a>
      </li>
    
  </ul>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - ZoOL -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'foxzool';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
